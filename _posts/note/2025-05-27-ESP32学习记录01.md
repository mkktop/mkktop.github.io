---
layout:       post
title:        "ESP32学习记录01"
subtitle:   "核心知识"
date:       2025-05-27 
author:       "mkk"
header-style: text
catalog:      true
tags:
    - 笔记
---

# freeRTOS
esp-idf是基于freeRTOS的框架，所以是首先要掌握的内容  

## freeRTOS任务概述  
在低端设备中，程序基本分为裸机和RTOS，针对简单的程序，我们用裸机程序完全可以满足，一旦功能复杂，程序模块众多，裸机程序往往很难满足我们的需求。因此我们就要用到RTOS系统。  

使用 FreeRTOS 的实时应用程序可以被构建为一组独立的任务。每个任务在自己的上下文中执行，不依赖于系统内的其他任务或 RTOS 调度器本身。  

任务分为四个状态：运行、准备就绪、阻塞、挂起  

### 运行
当任务实际执行时，它被称为处于运行状态。 任务当前正在使用处理器。 如果运行RTOS 的处理器只有一个内核， 那么在任何给定时间内都只能有一个任务处于运行状态。  

### 准备就绪
准备就绪任务指那些能够执行（它们不处于阻塞或挂起状态），但目前没有执行的任务，因为同等或更高优先级的不同任务已经处于运行状态。  

### 阻塞
如果任务当前正在等待时间或外部事件，则该任务被认为处于阻塞状态。例如，如果一个任务调用vTaskDelay()，它将被阻塞（被置于阻塞状态），直到延迟结束-一个时间事件。任务也可以通过阻塞来等待队列、信号量、事件组、通知或信号量事件。处于阻塞状态任
务通常有一个"超时"期， 超时后任务将被超时，并被解除阻塞，即使该任务所等待的事件没有发生。“阻塞”状态下的任务不使用任何处理时间，不能被选择进入运行状态。

### 挂起
与“阻塞”状态下的任务一样，“挂起”状态下的任务不能 被选择进入运行状态，但处于挂起状态的任务没有超时。相反，任务只有在分别通过 vTaskSuspend() 和 xTaskResume()API 调用明确命令时 才会进入或退出挂起状态。  

### 优先级
每个任务均被分配了从 0 到 (configMAX_PRIORITIES-1) 的优先级，其中的configMAX_PRIORITIES 在 FreeRTOSConfig.h 中定义，低优先级数字表示低优先级任务。空闲任务的优先级为零。

### 任务创建

```
BaseType_t xTaskCreatePinnedToCore(
 TaskFunction_t pvTaskCode, //任务函数指针，原型是 voidfun(void *param)
 const char *constpcName, //任务的名称，打印调试可能会有用
const uint32_t usStackDepth,//指定的任务堆栈空间大小（字节）
void *constpvParameters, //任务参数
UBaseType_t uxPriority,
 (configMAX_PRIORITIES- 1)
 // 优 先 级，数字越大，优先级越大，0 到
TaskHandle_t *constpvCreatedTask,
 //传回来的任务句柄
const BaseType_t xCoreID) //分配在哪个内核上运行
```

### 延迟函数

```
// 阻塞指定的时间，单位为系统时钟节拍数
void vTaskDelay( const TickType_t xTicksToDelay )
//用于在指定的时间点之前阻塞任务，直到时间到达。
void vTaskDelayUntil( TickType_t * const pxPreviousWakeTime, const TickType_t xTimeIncrement)
```

### 示例
```
#include <stdio.h>
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "esp_log.h"

void TASK1(void *pvParameters){
    while(1){
        printf("TASK 1\n");
        vTaskDelay(pdMS_TO_TICKS(500));
    }
}
void app_main(void)
{
    xTaskCreatePinnedToCore(TASK1, "TASK1", 2048, NULL, 1, NULL, 0);
    
}
```

